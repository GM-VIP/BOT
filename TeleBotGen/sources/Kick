#!/bin/bash

kick_fun () {
    # Ignorar si no es en grupo
    [[ "${message_chat_type[$id]}" != "supergroup" && "${message_chat_type[$id]}" != "group" ]] && return  

    grupo_admin="-1002826624584"  # Grupo donde se notificarÃ¡

    input="${comando[@]:1}"  # Todo lo que venga despuÃ©s de /kick
    id_input=$(echo "$input" | awk '{print $1}' | sed 's/@//g')  # Primer argumento
    razon=$(echo "$input" | cut -d' ' -f2-)  # El resto como razÃ³n (si hay)

    [[ -z "$id_input" ]] && {
        bot_retorno="âš ï¸ Debes ingresar un ID o @usuario\nUso: /kick 123456789 razÃ³n"
        msj_fun
        return
    }

    # Buscar ID, nombre y username
    target_id=$(jq -r ".[] | select(.usuario==\"$id_input\" or .id==\"$id_input\") | .id" /etc/ADM-db/VIP-database.json)
    target_name=$(jq -r ".[] | select(.id==\"$target_id\") | .nombre" /etc/ADM-db/VIP-database.json)
    target_user=$(jq -r ".[] | select(.id==\"$target_id\") | .usuario" /etc/ADM-db/VIP-database.json)

    [[ -z "$target_id" ]] && {
        bot_retorno="âŒ Usuario no encontrado en la base VIP."
        msj_fun
        return
    }

    # Preparar razÃ³n
    [[ -z "$razon" || "$razon" == "$id_input" ]] && razon="âœ˜"

    # Nombre del grupo
    nombre_grupo="${message_chat_title[$id]}"

    # Expulsar al usuario
    ShellBot.kickChatMember --chat_id "${message_chat_id[$id]}" --user_id "$target_id"
    # ShellBot.unbanChatMember --chat_id "${message_chat_id[$id]}" --user_id "$target_id"

    # âœ… Mensaje en el grupo
    texto_grupo="ğŸš« <b>Usuario expulsado exitosamente</b>\n"
    texto_grupo+="ğŸ†” ID: <code>$target_id</code>\n"
    texto_grupo+="ğŸ‘¤ Nombre: $target_name\n"
    texto_grupo+="ğŸ”— Usuario: @$target_user\n"
    texto_grupo+="ğŸ“ RazÃ³n: $razon"

    ShellBot.sendMessage --chat_id "${message_chat_id[$id]}" --text "$texto_grupo" --parse_mode html

    # âœ… Mensaje en grupo de administraciÃ³n
    texto_admin="ğŸš« <b>Usuario expulsado exitosamente</b>\n"
    texto_admin+="ğŸ†” ID: <code>$target_id</code>\n"
    texto_admin+="ğŸ‘¤ Nombre: $target_name\n"
    texto_admin+="ğŸ”— Usuario: @$target_user\n"
    texto_admin+="ğŸ“ RazÃ³n: $razon\n"
    texto_admin+="ğŸ·ï¸ Grupo: $nombre_grupo\n"
    texto_admin+="ğŸ‘®â€â™‚ï¸ Baneado por: @${message_from_username[$id]}"

    ShellBot.sendMessage --chat_id "$grupo_admin" --text "$texto_admin" --parse_mode html

    # âœ… Mensaje al usuario expulsado
    texto_priv="ğŸš« Has sido expulsado del grupo:\nğŸ·ï¸ <b>$nombre_grupo</b>"
    ShellBot.sendMessage --chat_id "$target_id" --text "$texto_priv" --parse_mode html
}
